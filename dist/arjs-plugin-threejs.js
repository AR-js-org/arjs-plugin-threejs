"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("three");function o(n){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const r in n)if(r!=="default"){const t=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,t.get?t:{enumerable:!0,get:()=>n[r]})}}return e.default=n,Object.freeze(e)}const a=o(h);class d{constructor(e={}){this.name="threejs-renderer",this.engine=null,this.renderer=null,this.scene=null,this.camera=null,this.anchors=new Map,this.containerElement=null,this.options={antialias:e.antialias!==void 0?e.antialias:!0,alpha:e.alpha!==void 0?e.alpha:!0,...e}}init(e){this.engine=e,this.renderer=new a.WebGLRenderer({antialias:this.options.antialias,alpha:this.options.alpha}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor(0,0),this.scene=new a.Scene,this.camera=new a.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,0,0),console.log("[ThreeJSRendererPlugin] Initialized")}enable(){if(!this.engine)throw new Error("Plugin must be initialized before enabling");const e=this.options.container||document.body;this.containerElement=e,e.appendChild(this.renderer.domElement),this.handleResize(),this.engine.on("engine:update",this.handleUpdate.bind(this)),this.engine.on("ar:marker",this.handleMarker.bind(this)),this.engine.on("ar:camera",this.handleCamera.bind(this)),window.addEventListener("resize",this.handleResize.bind(this)),console.log("[ThreeJSRendererPlugin] Enabled")}disable(){this.engine&&(this.engine.off("engine:update",this.handleUpdate.bind(this)),this.engine.off("ar:marker",this.handleMarker.bind(this)),this.engine.off("ar:camera",this.handleCamera.bind(this)),window.removeEventListener("resize",this.handleResize.bind(this)),this.renderer&&this.renderer.domElement&&this.renderer.domElement.parentNode&&this.renderer.domElement.parentNode.removeChild(this.renderer.domElement),console.log("[ThreeJSRendererPlugin] Disabled"))}dispose(){this.disable(),this.anchors.forEach(e=>{e.parent&&e.parent.remove(e)}),this.anchors.clear(),this.renderer&&(this.renderer.dispose(),this.renderer=null),this.scene&&(this.scene=null),this.camera&&(this.camera=null),this.engine=null,console.log("[ThreeJSRendererPlugin] Disposed")}handleUpdate(){this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}handleMarker(e){const{id:r,matrix:t,visible:s}=e;let i=this.anchors.get(r);i||(i=new a.Group,i.name=`marker-${r}`,this.scene.add(i),this.anchors.set(r,i)),i.visible=s,t&&Array.isArray(t)&&(i.matrix.fromArray(t),i.matrix.decompose(i.position,i.quaternion,i.scale))}handleCamera(e){e.projectionMatrix&&Array.isArray(e.projectionMatrix)&&this.setProjectionFromArray(e.projectionMatrix)}handleResize(){if(!this.renderer||!this.camera)return;const e=window.innerWidth,r=window.innerHeight;this.renderer.setSize(e,r),this.camera.aspect=e/r,this.camera.updateProjectionMatrix()}setProjectionFromArray(e){if(!this.camera||!Array.isArray(e)||e.length!==16){console.warn("[ThreeJSRendererPlugin] Invalid projection matrix");return}this.camera.projectionMatrix.fromArray(e),this.camera.projectionMatrixInverse.copy(this.camera.projectionMatrix).invert()}getScene(){return this.scene}getCamera(){return this.camera}getRenderer(){return this.renderer}getAnchor(e){return this.anchors.get(e)}}exports.ThreeJSRendererPlugin=d;
//# sourceMappingURL=arjs-plugin-threejs.js.map
