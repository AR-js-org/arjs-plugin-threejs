"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("three");function d(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const r in t)if(r!=="default"){const i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:()=>t[r]})}}return e.default=t,Object.freeze(e)}const a=d(o);class h{constructor(e={}){this.name="threejs-renderer",this.engine=null,this.renderer=null,this.scene=null,this.camera=null,this.anchors=new Map,this.containerElement=null,this.boundHandleUpdate=null,this.boundHandleMarker=null,this.boundHandleCamera=null,this.boundHandleResize=null,this.options={antialias:e.antialias!==void 0?e.antialias:!0,alpha:e.alpha!==void 0?e.alpha:!0,...e}}init(e){this.core=e,this.renderer=new a.WebGLRenderer({antialias:this.options.antialias,alpha:this.options.alpha}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor(0,0),this.scene=new a.Scene,this.camera=new a.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,0,0),console.log("[ThreeJSRendererPlugin] Initialized")}enable(){if(!this.core)throw new Error("Plugin must be initialized before enabling");const e=this.options.container||document.body;this.containerElement=e,e.appendChild(this.renderer.domElement),this.handleResize(),this.boundHandleUpdate=this.handleUpdate.bind(this),this.boundHandleMarker=this.handleMarker.bind(this),this.boundHandleCamera=this.handleCamera.bind(this),this.boundHandleResize=this.handleResize.bind(this),this.core.eventBus.on("engine:update",this.boundHandleUpdate),this.core.eventBus.on("ar:marker",this.boundHandleMarker),this.core.eventBus.on("ar:camera",this.boundHandleCamera),window.addEventListener("resize",this.boundHandleResize),console.log("[ThreeJSRendererPlugin] Enabled")}disable(){this.core&&(this.boundHandleUpdate&&this.core.off("engine:update",this.boundHandleUpdate),this.boundHandleMarker&&this.core.off("ar:marker",this.boundHandleMarker),this.boundHandleCamera&&this.core.off("ar:camera",this.boundHandleCamera),this.boundHandleResize&&window.removeEventListener("resize",this.boundHandleResize),this.boundHandleUpdate=null,this.boundHandleMarker=null,this.boundHandleCamera=null,this.boundHandleResize=null,this.renderer&&this.renderer.domElement&&this.renderer.domElement.parentNode&&this.renderer.domElement.parentNode.removeChild(this.renderer.domElement),console.log("[ThreeJSRendererPlugin] Disabled"))}dispose(){this.disable(),this.anchors.forEach(e=>{e.parent&&e.parent.remove(e)}),this.anchors.clear(),this.renderer&&(this.renderer.dispose(),this.renderer=null),this.scene&&(this.scene=null),this.camera&&(this.camera=null),this.core=null,console.log("[ThreeJSRendererPlugin] Disposed")}handleUpdate(){this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}handleMarker(e){const{id:r,matrix:i,visible:s}=e;let n=this.anchors.get(r);n||(n=new a.Group,n.name=`marker-${r}`,this.scene.add(n),this.anchors.set(r,n)),n.visible=s,i&&Array.isArray(i)&&(n.matrix.fromArray(i),n.matrix.decompose(n.position,n.quaternion,n.scale))}handleCamera(e){e.projectionMatrix&&Array.isArray(e.projectionMatrix)&&this.setProjectionFromArray(e.projectionMatrix)}handleResize(){if(!this.renderer||!this.camera)return;const e=this.containerElement||document.body,r=e.clientWidth,i=e.clientHeight;this.renderer.setSize(r,i),this.camera.aspect=r/i,this.camera.updateProjectionMatrix()}setProjectionFromArray(e){if(!this.camera||!Array.isArray(e)||e.length!==16){console.warn("[ThreeJSRendererPlugin] Invalid projection matrix");return}this.camera.projectionMatrix.fromArray(e),this.camera.projectionMatrixInverse.copy(this.camera.projectionMatrix).invert()}getScene(){return this.scene}getCamera(){return this.camera}getRenderer(){return this.renderer}getAnchor(e){return this.anchors.get(e)}}exports.ThreeJSRendererPlugin=h;
//# sourceMappingURL=arjs-plugin-threejs.js.map
