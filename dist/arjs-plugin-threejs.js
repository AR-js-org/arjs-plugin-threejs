"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const d=require("three");function o(r){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(r){for(const n in r)if(n!=="default"){const t=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,t.get?t:{enumerable:!0,get:()=>r[n]})}}return e.default=r,Object.freeze(e)}const a=o(d);class h{constructor(e={}){this.name="threejs-renderer",this.engine=null,this.renderer=null,this.scene=null,this.camera=null,this.anchors=new Map,this.containerElement=null,this.boundHandleUpdate=null,this.boundHandleMarker=null,this.boundHandleCamera=null,this.boundHandleResize=null,this.options={antialias:e.antialias!==void 0?e.antialias:!0,alpha:e.alpha!==void 0?e.alpha:!0,...e}}init(e){this.engine=e,this.renderer=new a.WebGLRenderer({antialias:this.options.antialias,alpha:this.options.alpha}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor(0,0),this.scene=new a.Scene,this.camera=new a.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,0,0),console.log("[ThreeJSRendererPlugin] Initialized")}enable(){if(!this.engine)throw new Error("Plugin must be initialized before enabling");const e=this.options.container||document.body;this.containerElement=e,e.appendChild(this.renderer.domElement),this.handleResize(),this.boundHandleUpdate=this.handleUpdate.bind(this),this.boundHandleMarker=this.handleMarker.bind(this),this.boundHandleCamera=this.handleCamera.bind(this),this.boundHandleResize=this.handleResize.bind(this),this.engine.on("engine:update",this.boundHandleUpdate),this.engine.on("ar:marker",this.boundHandleMarker),this.engine.on("ar:camera",this.boundHandleCamera),window.addEventListener("resize",this.boundHandleResize),console.log("[ThreeJSRendererPlugin] Enabled")}disable(){this.engine&&(this.boundHandleUpdate&&this.engine.off("engine:update",this.boundHandleUpdate),this.boundHandleMarker&&this.engine.off("ar:marker",this.boundHandleMarker),this.boundHandleCamera&&this.engine.off("ar:camera",this.boundHandleCamera),this.boundHandleResize&&window.removeEventListener("resize",this.boundHandleResize),this.boundHandleUpdate=null,this.boundHandleMarker=null,this.boundHandleCamera=null,this.boundHandleResize=null,this.renderer&&this.renderer.domElement&&this.renderer.domElement.parentNode&&this.renderer.domElement.parentNode.removeChild(this.renderer.domElement),console.log("[ThreeJSRendererPlugin] Disabled"))}dispose(){this.disable(),this.anchors.forEach(e=>{e.parent&&e.parent.remove(e)}),this.anchors.clear(),this.renderer&&(this.renderer.dispose(),this.renderer=null),this.scene&&(this.scene=null),this.camera&&(this.camera=null),this.engine=null,console.log("[ThreeJSRendererPlugin] Disposed")}handleUpdate(){this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}handleMarker(e){const{id:n,matrix:t,visible:s}=e;let i=this.anchors.get(n);i||(i=new a.Group,i.name=`marker-${n}`,this.scene.add(i),this.anchors.set(n,i)),i.visible=s,t&&Array.isArray(t)&&(i.matrix.fromArray(t),i.matrix.decompose(i.position,i.quaternion,i.scale))}handleCamera(e){e.projectionMatrix&&Array.isArray(e.projectionMatrix)&&this.setProjectionFromArray(e.projectionMatrix)}handleResize(){if(!this.renderer||!this.camera)return;const e=window.innerWidth,n=window.innerHeight;this.renderer.setSize(e,n),this.camera.aspect=e/n,this.camera.updateProjectionMatrix()}setProjectionFromArray(e){if(!this.camera||!Array.isArray(e)||e.length!==16){console.warn("[ThreeJSRendererPlugin] Invalid projection matrix");return}this.camera.projectionMatrix.fromArray(e),this.camera.projectionMatrixInverse.copy(this.camera.projectionMatrix).invert()}getScene(){return this.scene}getCamera(){return this.camera}getRenderer(){return this.renderer}getAnchor(e){return this.anchors.get(e)}}exports.ThreeJSRendererPlugin=h;
//# sourceMappingURL=arjs-plugin-threejs.js.map
