{"version":3,"file":"arjs-plugin-threejs.js","sources":["../src/threejs-renderer-plugin.js"],"sourcesContent":["import * as THREE from 'three';\r\n\r\n// Version injected at build time by Vite define.\r\n// If the define is missing (e.g. in a non-Vite test harness), fallback to 'unknown'.\r\nconst THREEJS_RENDERER_PLUGIN_VERSION =\r\n    typeof __THREEJS_RENDERER_PLUGIN_VERSION__ !== 'undefined'\r\n        ? __THREEJS_RENDERER_PLUGIN_VERSION__\r\n        : 'unknown';\r\n\r\nexport { THREEJS_RENDERER_PLUGIN_VERSION };\r\n/**\r\n * Plugin to render THREE.js scenes driven by AR markers.\r\n * Provides management of renderer, scene, camera and marker anchors.\r\n * Supported options: antialias, alpha, preferRAF, container, invertModelView, applyAxisFix\r\n */\r\n\r\nexport class ThreeJSRendererPlugin {\r\n    constructor(options = {}) {\r\n        this.name = 'threejs-renderer';\r\n        this.version = THREEJS_RENDERER_PLUGIN_VERSION;\r\n\r\n        this.engine = null;\r\n        this.emitter = null; // engine.eventBus preferred\r\n        this.renderer = null;\r\n        this.scene = null;\r\n        this.camera = null;\r\n        this.anchors = new Map();\r\n\r\n        this.options = {\r\n            antialias: options.antialias ?? true,\r\n            alpha: options.alpha ?? true,\r\n            preferRAF: options.preferRAF ?? true,            // render even if engine:update absent\r\n            container: options.container || null,            // DOM node to mount canvas\r\n            minConfidence: options.minConfidence ?? 0,       // optional filter for e.marker.confidence\r\n\r\n            // Legacy AR.js transform chain (defaults match classic AR.js)\r\n            useLegacyAxisChain: options.useLegacyAxisChain ?? true,\r\n            changeMatrixMode: options.changeMatrixMode || 'modelViewMatrix',\r\n\r\n            // Experimental (ignored if useLegacyAxisChain = true)\r\n            invertModelView: options.invertModelView ?? false,\r\n            applyAxisFix: options.applyAxisFix ?? false,\r\n\r\n            // NEW: Debug helpers (default off)\r\n            debugSceneAxes: options.debugSceneAxes ?? false,\r\n            sceneAxesSize: options.sceneAxesSize ?? 2,\r\n            debugAnchorAxes: options.debugAnchorAxes ?? false,\r\n            anchorAxesSize: options.anchorAxesSize ?? 0.5,\r\n            // NEW: dependency injection for tests\r\n            rendererFactory: options.rendererFactory || null,\r\n            ...options,\r\n        };\r\n\r\n        this._rafId = 0;\r\n\r\n        // For experimental path only\r\n        this._axisFix = new THREE.Matrix4()\r\n            .makeRotationY(Math.PI)\r\n            .multiply(new THREE.Matrix4().makeRotationZ(Math.PI));\r\n\r\n        console.log(\r\n            `[ThreeJSRendererPlugin] v${this.version} constructed`,\r\n            {\r\n                legacyAxisChain: this.options.useLegacyAxisChain,\r\n                changeMatrixMode: this.options.changeMatrixMode,\r\n                preferRAF: this.options.preferRAF,\r\n                debugSceneAxes: this.options.debugSceneAxes,\r\n                debugAnchorAxes: this.options.debugAnchorAxes,\r\n            }\r\n        );\r\n    }\r\n\r\n    init(engine) {\r\n        this.engine = engine;\r\n        this.emitter = engine?.eventBus || engine;\r\n\r\n        // Allow injection of a factory for tests\r\n        if (typeof this.options.rendererFactory === 'function') {\r\n            this.renderer = this.options.rendererFactory({\r\n                antialias: this.options.antialias,\r\n                alpha: this.options.alpha,\r\n            });\r\n        } else {\r\n            this.renderer = new THREE.WebGLRenderer({\r\n                antialias: this.options.antialias,\r\n                alpha: this.options.alpha,\r\n                preserveDrawingBuffer: false,\r\n            });\r\n            this.renderer.setPixelRatio(window.devicePixelRatio);\r\n            this.renderer.setClearColor(0x000000, 0);\r\n        }\r\n\r\n        this.scene = new THREE.Scene();\r\n        this.camera = new THREE.PerspectiveCamera(60, 1, 0.01, 2000);\r\n\r\n        // Lighting\r\n        this.scene.add(new THREE.AmbientLight(0xffffff, 0.6));\r\n        const dir = new THREE.DirectionalLight(0xffffff, 0.6);\r\n        dir.position.set(1, 1, 1);\r\n        this.scene.add(dir);\r\n\r\n        console.log('[ThreeJSRendererPlugin] Initialized', {\r\n            hasEventBus: !!engine?.eventBus,\r\n            version: this.version,\r\n        });\r\n    }\r\n\r\n    enable() {\r\n        const container = this.options.container || document.body;\r\n        container.appendChild(this.renderer.domElement);\r\n        this._resizeToContainer(container);\r\n\r\n        Object.assign(this.renderer.domElement.style, {\r\n            position: 'absolute',\r\n            inset: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            zIndex: '2',\r\n            display: 'block',\r\n            pointerEvents: 'none',\r\n        });\r\n\r\n        this._onUpdate = () => this.handleUpdate();\r\n        this._onMarker = (e) => this.handleUnifiedMarker(e);\r\n        this._onGetMarker = (e) => this.handleRawGetMarker(e);\r\n        this._onCamera = (e) => this.handleCamera(e);\r\n        this._onLegacyFound = (d) => this.handleUnifiedMarker(this._adaptLegacy(d, true));\r\n        this._onLegacyUpdated = (d) => this.handleUnifiedMarker(this._adaptLegacy(d, true));\r\n        this._onLegacyLost = (d) => this.handleUnifiedMarker(this._adaptLegacy(d, false));\r\n        this._onResize = () => this.handleResize();\r\n\r\n        this._sub('engine:update', this._onUpdate);\r\n        this._sub('ar:marker', this._onMarker);\r\n        this._sub('ar:getMarker', this._onGetMarker);\r\n        this._sub('ar:camera', this._onCamera);\r\n        this._sub('ar:markerFound', this._onLegacyFound);\r\n        this._sub('ar:markerUpdated', this._onLegacyUpdated);\r\n        this._sub('ar:markerLost', this._onLegacyLost);\r\n\r\n        window.addEventListener('resize', this._onResize);\r\n\r\n        if (this.options.preferRAF) {\r\n            const loop = () => {\r\n                this._rafId = requestAnimationFrame(loop);\r\n                this.handleUpdate();\r\n            };\r\n            this._rafId = requestAnimationFrame(loop);\r\n        }\r\n\r\n        // Debug: scene axes (optional)\r\n        if (this.options.debugSceneAxes) {\r\n            this.scene.add(new THREE.AxesHelper(this.options.sceneAxesSize));\r\n        }\r\n\r\n        console.log('[ThreeJSRendererPlugin] Enabled v' + this.version);\r\n    }\r\n\r\n    disable() {\r\n        if (this.emitter?.off) {\r\n            this._off('engine:update', this._onUpdate);\r\n            this._off('ar:marker', this._onMarker);\r\n            this._off('ar:getMarker', this._onGetMarker);\r\n            this._off('ar:camera', this._onCamera);\r\n            this._off('ar:markerFound', this._onLegacyFound);\r\n            this._off('ar:markerUpdated', this._onLegacyUpdated);\r\n            this._off('ar:markerLost', this._onLegacyLost);\r\n        }\r\n        window.removeEventListener('resize', this._onResize);\r\n        if (this._rafId) cancelAnimationFrame(this._rafId);\r\n        this._rafId = 0;\r\n        if (this.renderer?.domElement?.parentNode) {\r\n            this.renderer.domElement.parentNode.removeChild(this.renderer.domElement);\r\n        }\r\n        console.log('[ThreeJSRendererPlugin] Disabled v' + this.version);\r\n    }\r\n\r\n    dispose() {\r\n        this.disable();\r\n        this.anchors.forEach(a => a.parent?.remove(a));\r\n        this.anchors.clear();\r\n        this.renderer?.dispose?.();\r\n        this.renderer = null;\r\n        this.scene = null;\r\n        this.camera = null;\r\n        this.engine = null;\r\n        this.emitter = null;\r\n        console.log('[ThreeJSRendererPlugin] Disposed v' + this.version);\r\n    }\r\n\r\n    _sub(ev, fn) { try { this.emitter?.on?.(ev, fn); } catch {} }\r\n    _off(ev, fn) { try { this.emitter?.off?.(ev, fn); } catch {} }\r\n\r\n    _adaptLegacy(d, visible) {\r\n        return {\r\n            id: String(d?.markerId ?? d?.id ?? '0'),\r\n            matrix: d?.matrix || d?.transformationMatrix || d?.modelViewMatrix || d?.poseMatrix || null,\r\n            visible,\r\n            _legacy: true,\r\n        };\r\n    }\r\n\r\n    handleRawGetMarker(e) {\r\n        if (!e) return;\r\n        const confidence = e?.marker?.confidence;\r\n        if (confidence !== undefined && confidence < this.options.minConfidence) return;\r\n        const id = String(\r\n            e?.marker?.markerId ??\r\n            e?.marker?.id ??\r\n            e?.marker?.pattHandle ??\r\n            e?.marker?.uid ??\r\n            e?.marker?.index ??\r\n            '0'\r\n        );\r\n        const matrix = e?.matrix;\r\n        this.handleUnifiedMarker({ id, matrix, visible: true, _source: 'ar:getMarker' });\r\n    }\r\n\r\n    handleUnifiedMarker(evt) {\r\n        const { id, matrix, visible } = evt || {};\r\n        if (id == null) return;\r\n\r\n        let anchor = this.anchors.get(id);\r\n        if (!anchor) {\r\n            anchor = new THREE.Group();\r\n            anchor.name = `marker-${id}`;\r\n            anchor.matrixAutoUpdate = false;\r\n            // Debug: anchor axes (optional)\r\n            if (this.options.debugAnchorAxes) {\r\n                anchor.add(new THREE.AxesHelper(this.options.anchorAxesSize));\r\n            }\r\n            this.scene.add(anchor);\r\n            this.anchors.set(id, anchor);\r\n            console.log('[ThreeJSRendererPlugin] anchor created', id);\r\n        }\r\n\r\n        if (typeof visible === 'boolean') anchor.visible = visible;\r\n\r\n        if (Array.isArray(matrix) && matrix.length === 16) {\r\n            const modelView = new THREE.Matrix4().fromArray(matrix);\r\n\r\n            let final;\r\n            if (this.options.useLegacyAxisChain) {\r\n                // Legacy chain: R_y(π) * R_z(π) * modelView * R_x(π/2)\r\n                const projectionAxis = new THREE.Matrix4()\r\n                    .makeRotationY(Math.PI)\r\n                    .multiply(new THREE.Matrix4().makeRotationZ(Math.PI));\r\n                const markerAxis = new THREE.Matrix4().makeRotationX(Math.PI / 2);\r\n                final = new THREE.Matrix4()\r\n                    .copy(projectionAxis)\r\n                    .multiply(modelView)\r\n                    .multiply(markerAxis);\r\n\r\n                if (this.options.changeMatrixMode === 'cameraTransformMatrix') {\r\n                    final.invert();\r\n                }\r\n            } else {\r\n                // Experimental path\r\n                final = modelView.clone();\r\n                if (this.options.invertModelView) final.invert();\r\n                if (this.options.applyAxisFix) final.multiply(this._axisFix);\r\n            }\r\n\r\n            anchor.matrix.copy(final);\r\n            anchor.matrix.decompose(anchor.position, anchor.quaternion, anchor.scale);\r\n        }\r\n    }\r\n\r\n    handleCamera(e) {\r\n        const arr = e?.projectionMatrix || e?.matrix;\r\n        if (Array.isArray(arr) && arr.length === 16) {\r\n            this.camera.projectionMatrix.fromArray(arr);\r\n            this.camera.projectionMatrixInverse.copy(this.camera.projectionMatrix).invert();\r\n            console.log('[ThreeJSRendererPlugin] Projection applied v' + this.version);\r\n        }\r\n    }\r\n\r\n    handleUpdate() {\r\n        if (this.renderer && this.scene && this.camera) {\r\n            this.renderer.render(this.scene, this.camera);\r\n        }\r\n    }\r\n\r\n    handleResize() {\r\n        const container = this.options.container || document.body;\r\n        this._resizeToContainer(container);\r\n    }\r\n\r\n    _resizeToContainer(container) {\r\n        const w = container.clientWidth || window.innerWidth;\r\n        const h = container.clientHeight || Math.round(w * 3 / 4);\r\n        this.renderer.setSize?.(w, h);\r\n        this.camera.aspect = w / h;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n    getAnchor(id) { return this.anchors.get(String(id)); }\r\n    getScene() { return this.scene; }\r\n    getCamera() { return this.camera; }\r\n    getRenderer() { return this.renderer; }\r\n}"],"names":["THREEJS_RENDERER_PLUGIN_VERSION","ThreeJSRendererPlugin","options","THREE","engine","dir","container","e","d","loop","a","ev","fn","visible","confidence","id","matrix","evt","anchor","modelView","final","projectionAxis","markerAxis","arr","w","h"],"mappings":"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"}